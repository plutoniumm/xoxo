<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XOXO – Rules</title>
  <link rel="stylesheet" href="https://manav.ch/atomic.css">
  <link rel="icon" type="image/svg+xml" href="/icon.svg" />

  <style>
    body {
      background: #2D0A52;
      color: #fff;
    }

    .wrap {
      display: grid;
      grid-template-columns: 1fr;
      align-items: start;
      gap: 2rem;
      min-height: 100vh;
      position: relative;
    }

    /* Full-screen 3D background */
    #bg-3d {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
    }

    #bg-3d canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .rules {
      background: #fff1;
      border: 1px solid #fff1;
      box-shadow: 0 10px 30px #0006;
      margin-inline: auto;
      max-width: 720px;
    }

    .rules p,
    .rules li {
      line-height: 1.6;
      color: #ddd;
    }

    .btn {
      background: #29b6f6;
      color: #061018;
    }

    .btn:hover {
      filter: brightness(1.06);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div id="bg-3d" aria-hidden="true"></div>

    <main class="rules rx10 blur p20" aria-labelledby="rules-title" style="margin-top: 20%;">
      <h1 id="rules-title">XOXO Quantum Tic-Tac-Toe</h1>
      <p>A 3×3×3 grid. Each player gets two moves per round to place superposed marks.</p>

      <h2>How to play</h2>
      <ul>
        <li>On your turn, place two tentative marks (superposition) on different cells.</li>
        <li>After each round (two X moves and two O moves), the state collapses: one definitive X and one definitive O
          remain.</li>
        <li>Continue until the board resolves; three in a row wins!</li>
      </ul>

      <a href="/game.html" class="btn rx10 p10 fw5" id="start-btn">Start Game</a>
    </main>
  </div>

  <script type="module">
    import * as THREE from 'three';
    import Shapes from '/src/geometry.ts';

    const makeScene = ( mountEl ) => {
      const scene = new THREE.Scene();
      scene.background = new THREE.Color( 0x2D0A52 );

      const camera = new THREE.PerspectiveCamera( 55, 1, 0.1, 100 );
      camera.position.set( 0, 0, 2.6 );

      const renderer = new THREE.WebGLRenderer( { antialias: true, alpha: true } );
      renderer.setPixelRatio( window.devicePixelRatio );
      mountEl.appendChild( renderer.domElement );

      const light1 = new THREE.DirectionalLight( 0xffffff, 1.0 );
      light1.position.set( 2, 3, 4 );
      const light2 = new THREE.AmbientLight( 0xffffff, 0.4 );
      scene.add( light1, light2 );

      const group = new THREE.Group();
      const size = 0.32;
      const gap = 0.5;

      // Randomly choose shape type for each cell
      const choices = [
        ( s ) => Shapes.cross( s ),
        ( s ) => Shapes.half_cross( s ),
        ( s ) => Shapes.sphere( s ),
        ( s ) => Shapes.half_sphere( s ),
      ];

      for ( let x = -1;x <= 1;x++ ) {
        for ( let y = -1;y <= 1;y++ ) {
          for ( let z = -1;z <= 1;z++ ) {
            const create = choices[ Math.floor( Math.random() * choices.length ) ];
            const shape = create( size );
            shape.position.set( x * gap, y * gap, z * gap );
            group.add( shape );
          }
        }
      }
      group.scale.set( 1.35, 1.35, 1.35 );
      scene.add( group );

      const onResize = () => {
        const w = window.innerWidth;
        const h = window.innerHeight;
        renderer.setSize( w, h );
        camera.aspect = w / h;
        camera.updateProjectionMatrix();
      };
      window.addEventListener( 'resize', onResize );
      onResize();

      const clock = new THREE.Clock();
      const animate = () => {
        const t = clock.getElapsedTime();
        group.rotation.y = t * 0.25;
        group.rotation.x = Math.sin( t * 0.15 ) * 0.1;
        renderer.render( scene, camera );
        requestAnimationFrame( animate );
      };
      animate();

      return { scene, camera, renderer };
    };

    // Mount one full-screen scene
    const bg = document.getElementById( 'bg-3d' );
    makeScene( bg );
  </script>
</body>

</html>